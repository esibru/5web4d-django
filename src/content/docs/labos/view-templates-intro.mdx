---
title: Vues et templates - introduction
description: Docs intro
---
import { Aside, Steps } from '@astrojs/starlight/components';

Une vue est un ¬´ type ¬ª de page Web dans votre application Django qui sert g√©n√©ralement √† une fonction pr√©cise et poss√®de un gabarit sp√©cifique. Par exemple, dans une application de blog, vous pouvez avoir les vues suivantes :

* La page d'accueil du blog - affiche quelques-uns des derniers billets.
* La page de ¬´ d√©tail ¬ª d'un billet - lien permanent vers un seul billet.
* La page d'archives pour une ann√©e - affiche tous les mois contenant des billets pour une ann√©e donn√©e.
* La page d'archives pour un mois - affiche tous les jours contenant des billets pour un mois donn√©.
* La page d'archives pour un jour - affiche tous les billets pour un jour donn√©.
* Action de commentaire - g√®re l'√©criture de commentaires sur un billet donn√©.

Dans notre application, nous poss√©dons plusieurs vues. Parmi celles-ci :
* une page d'accueil ;
* une page qui liste les d√©veloppeurs ;
* une page qui donne le d√©tail des d√©veloppeurs - c'est-√†-dire le nom, pr√©nom ainsi que toutes ses t√¢ches ;
* une page pour l'ensemble des t√¢ches...

Dans Django, les pages Web et les autres contenus sont g√©n√©r√©s par des vues. Chaque vue est repr√©sent√©e par une fonction Python. Django choisit une vue en examinant l'URL demand√©e (pour √™tre pr√©cis, la partie de l'URL apr√®s le nom de domaine).

Un mod√®le d'URL est la forme g√©n√©rale d'une URL ; par exemple : `/archive/<ann√©e>/<mois>/`.

Pour passer de l'URL √† la vue, Django utilise ce qu'on appelle des configurations d'URL (URLconf). Une configuration d'URL associe des motifs d'URL √† des vues.

### Les gabarits (templates)

La vue que nous avons √©crite jusqu'√† maintenant est tr√®s sommaire, une page web ne ressemble en rien √† cela.

De plus, il y a un probl√®me : l'allure de la page est cod√©e en dur dans la vue. Si vous voulez changer le style de la page, vous devrez modifier votre code Python. Nous allons donc utiliser le syst√®me de gabarits de Django pour s√©parer le style du code Python en cr√©ant un gabarit que la vue pourra utiliser.

Tout d'abord, cr√©ez un r√©pertoire nomm√© `templates` dans votre r√©pertoire `developer`. C'est l√† que Django recherche les gabarits.

Le param√®tre `TEMPLATES` de votre projet indique comment Django va charger et produire les gabarits. Le fichier de r√©glages par d√©faut configure un moteur DjangoTemplates dont l'option `APP_DIRS` est d√©finie √† `True`. Par convention, DjangoTemplates recherche un sous-r√©pertoire `templates` dans chaque application figurant dans `INSTALLED_APPS`.

<Aside title="Exercice" icon="pencil">
V√©rifiez la pr√©sence de l'option dans le fichier `mproject/settings.py`.
</Aside>

Dans le r√©pertoire `templates` que vous venez de cr√©er, cr√©ez un autre r√©pertoire nomm√© `developer` dans lequel vous placez un nouveau fichier `index.html`. Autrement dit, le chemin de votre gabarit doit √™tre `developer/templates/developer/index.html`. Conform√©ment au fonctionnement du chargeur de gabarit `app_directories` (cf. explication ci-dessus), vous pouvez d√©signer ce gabarit dans Django par `developer/index.html`.


> *_Gabarits : espace de nom_* 
>
> Il serait aussi possible de placer directement nos gabarits dans `developer/templates` (plut√¥t que dans un sous-r√©pertoire `developer`), mais ce serait une mauvaise id√©e. Django choisit le premier gabarit qu'il trouve pour un nom donn√© et dans le cas o√π vous avez un gabarit de m√™me nom dans une autre application, Django ne fera pas la diff√©rence. Il faut pouvoir indiquer √† Django le bon gabarit, et la meilleure mani√®re de faire cela est d'utiliser des espaces de noms. C'est-√†-dire que nous pla√ßons ces gabarits dans un autre r√©pertoire portant le nom de l'application.

Lisez et ins√©rez ce code dans le gabarit `developer/index.html`

```html showLineNumbers=false title="developer/templates/developer/index.html"
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, > initial-scale=1.0">
    <title>MProject</title>
</head>
<body>
    <h1>MProject</h1>
    <h2>Liste des d√©veloppeurs</h2>

    {% if developers %}
    <ul>
        {% for dev in developers %}
        <li>{{ dev.first_name }}</li>
        {% endfor %}
    </ul>
    {% else %}
        <p><strong>Il n'y a aucun d√©veloppeur enregistr√© !</strong></p>
    {% endif %}
</body>
</html>
```

Mettez √† jour la vue afin de permettre le rendu de ce gabarit.

``` python showLineNumbers=false title="developer/views.py" del={2, 7} ins={4, 8, 9, 10, 12} 
  from django.shortcuts import render
  from django.http import HttpResponse
  
  from .models import Developer
  
  def index(request):
      return HttpResponse("Hello, world. You're at the developers index.")
      context = {
          'developers': Developer.objects.all()
      }
  
      return render(request, 'developer/index.html', context)
```

Ce code charge le gabarit appel√© `developer/index.html` et lui fournit un contexte. Ce contexte est un dictionnaire qui fait correspondre des objets Python (valeurs) √† des noms de variables de gabarit (cl√©s).

Chargez la page en appelant l'URL `/developer/` dans votre navigateur vous devriez voir une liste √† puces contenant une liste de d√©veloppeurs.

<Aside icon="pencil" title="Exercice">

1. Supprimez chacun des d√©veloppeurs et v√©rifiez que le message "II n'y a aucun d√©veloppeur enregistr√© !" soit bien affich√©. 
1. Rajoutez ensuite au moins deux d√©veloppeurs.
1. Modifier le gabarit pour ajouter le nom des d√©veloppeurs.

</Aside>

## Une deuxi√®me vue

Nous allons ajouter une deuxi√®me vue qui va nous permettre d'afficher le d√©tail des informations que l'on a sur les d√©veloppeurs. Nous allons devoir compl√©ter les √©tapes suivantes : 

<Steps>

1. Ajout d'une URL qui pointe vers la nouvelle vue

   ``` python showLineNumbers=false title="developer/urls.py"
     urlpatterns = [
        path('', views.index, name='index'),
        path('<int:developer_id>/', views.detail, name='detail'),
     ]
   ```
1. Ajout d'une vue

   ``` python showLineNumbers=false title="developer/views.py" ins={8, 9, 10}
     def index(request):
         context = {
             'developers': Developer.objects.all(),
         }
         return render(request, 'developer/index.html', context)
     
     
     def detail(request, developer_id):
         developer = Developer.objects.get(pk=developer_id)
         return render(request, 'developer/detail.html', {'developer': developer})
   ```
1. Ajout d'un nouveau gabarit.

   ```html showLineNumbers=false title="developer/templates/developer/detail.html"
   <!DOCTYPE html>
   <html lang="fr">
   <head>
       <meta charset="UTF-8">
       <meta name="viewport" content="width=device-width, initial-scale=1.0">
       <title>MProject</title>
   </head>
   <body>
       <h1>MProject</h1>
       <h2>D√©tail de {{ developer.first_name }}</h2>
   
       <p><Strong>Pr√©nom : {{ developer.first_name }}</Strong></p>
       <p><Strong>Nom de famille : {{ developer.last_name }}</Strong></p>
   </body>
   </html>
   ```
</Steps>

Ouvrez votre navigateur √† l'adresse ¬´ `/developer/3/` ¬ª. La m√©thode `detail()` sera ex√©cut√©e et affichera le d√©veloppeur fourni dans l'URL.

<Aside type="tip">
> Nous vous sugg√©rons ici d'utiliser la valeur 3 pour l'adresse. Cette valeur devrait correspond √† l'id du d√©veloppeur que vous avez recr√©√© apr√®s avoir supprim√©, comme demand√©, les deux d√©veloppeurs "sdr" et "jlc". Si vous avez un doute, vous pouvez aller dans le `shell` et lancer la commande `[dev.id for dev in Developer.objects.all()]` apr√®s avoir import√© la classe `Developer`. Cette commande va vous retourner la liste des identifiants pr√©sents dans la base de donn√©e. (Ce code n'a rien de magique, il s'agit de la constitution d'une liste sur base d'un parcours des d√©veloppeurs disponibles dans la BDD.)
</Aside>

Lorsque quelqu'un demande une page de votre site Web, par exemple `/developer/3/`, Django charge le module Python `mproject.urls` parce qu'il est mentionn√© dans le r√©glage `ROOT_URLCONF`. Il trouve la variable nomm√©e `urlpatterns` et parcourt les motifs dans l'ordre. Apr√®s avoir trouv√© la correspondance `developer/`, il retire le texte correspondant (`developer/`) et passe le texte restant - `3/` - √† la configuration d'URL `developer.urls` pour la suite du traitement. Dans le cas pr√©sent, c'est `<int:developer_id>/` qui correspond, ce qui aboutit √† un appel √† la vue `detail()` comme ceci :

``` python showLineNumbers=false frame="none"
detail(request=<HttpRequest object>, developer_id=3)
```

La partie `developer_id=3` vient de `<int:developer_id>`. En utilisant des chevrons, cela ¬´ capture ¬ª une partie de l'URL l'envoie en tant que param√®tre nomm√© √† la fonction de vue ; la partie `:developer_id>` de la cha√Æne d√©finit le nom qui va √™tre utilis√© pour identifier le motif trouv√©, et la partie `<int:` est un convertisseur qui d√©termine ce √† quoi les motifs doivent correspondre dans cette partie du chemin d'URL.

Pour plus d'info sur la distribution d'URL, cela se passe [ici](https://docs.djangoproject.com/fr/4.1/topics/http/urls/). üìñ

### Erreur 404

Si vous avez bien suivi ce cours jusqu'√† maintenant, vous ne devriez pas avoir rencontr√© d'erreur. Si vous vous rendez sur l'adresse `localhost:8000/developer/42` vous serez redirig√© vers une page d'erreur Django. En effet, √† moins d'avoir cr√©√© beaucoup de d√©veloppeurs, le d√©veloppeur poss√©dant l'id 42 n'existe pas.

Nous pouvons corriger cela en utilisant la fonction `get_object_or_404`.

``` python showLineNumbers=false title="developer/views.py" ins={1, 15} del={14}
  from django.shortcuts import render, get_object_or_404
  from django.http import HttpResponse
  
  from .models import Developer
  
  def index(request):
      context = {
          'developers': Developer.objects.all(),
      }
  
      return render(request, 'developer/index.html', context)
  
  def detail(request, developer_id):
      developer = Developer.objects.get(pk=developer_id)
      developer = get_object_or_404(Developer, pk=developer_id)
      return render(request, 'developer/detail.html', {'developer': developer})
```


La fonction `get_object_or_404()` prend un mod√®le Django comme premier param√®tre et un nombre arbitraire de param√®tres mots-cl√©s, qu'il transmet √† la m√©thode `get()` du gestionnaire du mod√®le. Elle l√®ve une exception `Http404` si l'objet n'existe pas.

### Lien entre les vues

Pour passer d'une vue √† l'autre, nous allons naturellement utiliser des liens `html` (`<a>`).
Revenons dans la vue `index` et plus pr√©cis√©ment dans le gabarit et ajoutons ces liens.

``` html showLineNumbers=false title="developer/templates/developer/index.html" ins={6, 7} del={5}
  # ...
      {% if developers %}
      <ul>
          {% for dev in developers %}
          <li>{{ dev.first_name }}</li>
          {#<li>{{ dev.first_name }}</li>#} üëà ceci est comment√© !
          <li><a href='/developer/{{ dev.id }}'>{{ dev.first_name }}</a></li>
          {% endfor %}
      </ul>
      {% else %}
          <p><strong>Il n'y a aucun d√©veloppeur enregistr√© !</strong>/p>
      {% endif %}
  # ...
</body>
```

Vous pouvez maintenant essayer d'aller sur l'index de votre site et suivre les liens qui sont cr√©√©s !

#### Configurer les chemins via `{% url %}`

Le probl√®me de cette approche cod√©e en dur et fortement coupl√©e est qu'il devient fastidieux de modifier les URL dans des projets qui ont beaucoup de gabarits. Cependant, comme vous avez d√©fini le param√®tre `name` dans les fonctions `path()` du module `developer.urls`, vous pouvez supprimer la d√©pendance en chemins d'URL sp√©cifiques d√©finis dans les configurations d'URL en utilisant la balise de gabarit `{% url %}` :

``` python showLineNumbers=false title="developer/templates/developer/index.html"
<li><a href="{% url 'detail' dev.id %}">{{ dev.first_name }}</a></li>
```

Le principe de ce fonctionnement est que l'URL est recherch√©e dans les d√©finitions du module `developer.urls`. Ci-dessous, vous pouvez voir exactement o√π le nom d'URL "detail" est d√©fini :

``` python showLineNumbers=false title="developer/urls.py"
path('<int:developer_id>/', views.detail, name='detail'),
```

Si vous souhaitez modifier l'URL de d√©tail des d√©veloppeurs, par exemple sur le mod√®le `developer/specifics/12/`, il suffit de faire la modification dans `developer/urls.py`. Il n'est pas n√©cessaire de modifier un nombre potentiellement grand de gabarit.

``` python showLineNumbers=false title="developer/urls.py" ins={2} del={1}
  path('<int:developer_id>/', views.detail, name='detail'),
  path('specifics/<int:developer_id>/', views.detail, name='detail'),
```

#### Espaces de noms et noms d'URL

Le projet ne contient actuellement qu'une seule application, `developer`. Plus tard, une autre application va se greffer √† notre projet. Comment Django arrive-t-il √† diff√©rencier les noms d'URL entre elles ? Par exemple, l'application `developer` poss√®de une vue `detail` et il se peut tout √† fait qu'une autre application du m√™me projet en poss√®de aussi une. Comment peut-on indiquer √† Django quelle vue d'application il doit appeler pour une URL lors de l'utilisation de la balise de gabarit `{% url %}` ?

La r√©ponse est donn√©e par l'ajout d'espaces de noms √† votre configuration d'URL. Dans le fichier `developer/urls.py`, ajoutez une variable `app_name` pour d√©finir l'espace de nom de l'application :

```python showLineNumbers=false title="developer/urls.py"
app_name = 'developer' üëànew
urlpatterns = [
    path('', views.index, name='index'),
    path('<int:developer_id>/', views.detail, name='detail'),
]
```

Modifiez maintenant les liens du gabarit `developer/index.html` pour qu'elle pointe vers la vue ¬´ detail ¬ª √† l'espace de nom correspondant.

``` html showLineNumbers=false title="developer/index.html"
#...
{% if developers %}
<ul>
    {% for dev in developers %}
    {#<li>{{ dev.first_name }}</li>#}
    <li><a href="{% url 'developer:detail' dev.id %}">{{ dev.first_name }}</a></li> <!--üëà ajout de "developer:" -->
    {% endfor %}
</ul>
#...
```
